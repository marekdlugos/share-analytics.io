<!DOCTYPE html>
<html lang="en" class="no-js">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Discover how viral are your links!</title>
		<meta name="description" content="Share analytics for your links! Provides information and graph based on social networks data." />
		<meta name="keywords" content="social analytics, social, analytics, viral, link" />
		<meta name="author" content="Share Analytics" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="css/normalize.css" />
		<link rel="stylesheet" type="text/css" href="css/styles.css" />
		<link href='http://fonts.googleapis.com/css?family=Raleway:200,400,800' rel='stylesheet' type='text/css'>
		<!--[if IE]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>
	<body>
		<a href="index.html" class="service">Analyze single link</a>
		<div class="container stars" id="container">
			<div class="content" id="content">
				<div id="large-header" class="large-header">
					<canvas id="stars-canvas"></canvas>
					<div class="content">
						<h1 class="main-title">Discover how viral <br>your links are</h1>
						<form id="bulkForm" method="GET">
							<textarea name="url" id="urls" rows="10" placeholder="Paste your links here..." required></textarea>
							<input type="submit" id="analyze" value="Analyze" />
						</form>
					</div>
				</div>
			</div>

			<ul style="display: none;" id="results"></ul>

		</div>

		<script>
			function animateValue(id, start, end, duration) {
				var range = end - start;
				var current = start;
				var increment = end > start? 1 : -1;
				var stepTime = Math.abs(Math.floor(duration / range));
				var obj = document.getElementById(id);
				var timer = setInterval(function() {
					if (current == end) {
						clearInterval(timer);
						obj.innerHTML = current;
						return
					}
					current += increment;
					obj.innerHTML = current;
				}, stepTime);
			}

		</script>

		<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
		<script>
			$(document).ready(function(){
				var isFetched = true;
				$( "#bulkForm" ).submit(function( e ) {
					e.preventDefault();
					var $form = $( this );
					url = "https://t4fzdgrbyi.execute-api.eu-west-1.amazonaws.com/prod/bulk";
					urls = $form.find( "#urls" ).val();

					$.ajax({
						url: url,
						method: "POST",
						data: urls,
						contentType: "application/json",
						dataType: "json"
					}).done(function(data) {
						if(!isFetched)return;
						isFetched = false;
						$("#results" ).css("display","block");
						$( "#content" ).css("display","none");
						$("#container").removeClass("stars");
						$("body").addClass("results");
						$("head").prepend("<link rel=\"stylesheet\" type=\"text/css\" href=\"css/bootstrap.min.css\" />");
						var i = 0;
						$.each(data, function( url, value ) {
							$("#results").append("<li>\
						<div class=\"row\">\
								<div class=\"col md-12\">\
								<h2><a href=\"" + url + "\">"+ url +"</a></h2\>\
						</div>\
						</div>\
						<div class=\"row\">\
								<div class=\"col-md-3 facebook\">\
								<span>Facebook likes</span>\
						<h3><i class=\"fa fa-icon fa-facebook-official\"></i> <span id=\"facebook"+i+"\"></span></h3>\
						</div>\
						<div class=\"col-md-3 twitter\">\
								<span>Twitter tweets</span>\
						<h3><i class=\"fa fa-icon fa-twitter\"></i> <span id=\"twitter"+i+"\"></span></h3>\
						</div>\
						<div class=\"col-md-3 google\">\
								<span>Google +1</span>\
								<h3><i class=\"fa fa-icon fa-google-plus\"></i> <span id=\"google"+i+"\"></span></h3>\
						</div>\
						<div class=\"col-md-3 linkedin\">\
								<span>LinkedIn shares</span>\
						<h3><i class=\"fa fa-icon fa-linkedin-square\"></i> <span id=\"linkedin"+i+"\"></span></h3>\
						</div>\
						</div>\
						</li>\
						");

							if(value['facebook-shares'] == undefined)value['facebook-shares'] = 0;
							if(value['twitter'] == undefined)value['twitter'] = 0;
							if(value['linkedin'] == undefined)value['linkedin'] = 0;
							if(value['googleplus'] == undefined)value['googleplus'] = 0;
							console.log(value['facebook-shares']);

							var facebook_min = parseInt(value['facebook-shares']) - 200 > 0 ? parseInt(value['facebook-shares']) - 200 : 0;
							animateValue("facebook"+i, facebook_min, value['facebook-shares'], 1000);

							var twitter_min = parseInt(value['twitter']) - 200 > 0 ? parseInt(value['twitter'])-200 : 0;
							animateValue("twitter"+i,twitter_min, value['twitter'], 1000);

							var linkedin_min = parseInt(value['linkedin']) - 200 > 0 ? parseInt(value['linkedin'])-200 : 0;
							animateValue("linkedin"+i,linkedin_min, value['linkedin'], 1000);

							if(value['googleplus'] == -1) {
								$('#google'+i).innerHTML = "Moc";
							}
							else {
								var google_min = parseInt(value['googleplus']) - 200 > 0 ? parseInt(value['googleplus']) - 200 : 0;
								animateValue("google"+i, google_min, value['googleplus'], 1000);
							}
							i++;
						});
					});

				});
			})
		</script>
		<script src="js/TweenLite.min.js"></script>
		<script src="js/EasePack.min.js"></script>
		<script src="js/rAF.js"></script>
		<script src="js/main.js"></script>
	</body>
</html>
